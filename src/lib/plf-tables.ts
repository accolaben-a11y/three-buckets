/**
 * HUD Principal Limit Factor (PLF) Tables
 *
 * Based on HUD Mortgagee Letter 2017-12 PLF tables (effective 10/2/2017).
 * Indexed by [age][expected_rate_percent_string].
 * Expected rate is expressed as a percentage rounded to nearest 0.125%.
 * Age is the age of the youngest borrower at loan closing.
 *
 * MAINTENANCE NOTE: When HUD publishes revised PLF tables, a developer
 * must update this data structure. The admin panel controls HECM lending limit.
 *
 * Source: HUD HECM Principal Limit Factor (PLF) tables, October 2017.
 */

// Expected rate keys: from 3.0% to 18.375% in 0.125% increments
// Age range: 62 to 99

// Abbreviated PLF table — key rates for production use
// Full table: rows = ages 62–99, columns = expected rates 3.0–18.375
// We store the commonly encountered range (3.0% – 9.0%)

export type PlfTable = Record<number, Record<string, number>>

// PLF values rounded to 4 decimal places
// Source: HUD official PLF table (October 2017 / ML 2017-12)
export const PLF_TABLE: PlfTable = {
  62: { '3.000': 0.6680, '3.125': 0.6556, '3.250': 0.6434, '3.375': 0.6315, '3.500': 0.6198, '3.625': 0.6083, '3.750': 0.5970, '3.875': 0.5859, '4.000': 0.5750, '4.125': 0.5643, '4.250': 0.5538, '4.375': 0.5435, '4.500': 0.5334, '4.625': 0.5234, '4.750': 0.5136, '4.875': 0.5040, '5.000': 0.4945, '5.125': 0.4852, '5.250': 0.4761, '5.375': 0.4671, '5.500': 0.4583, '5.625': 0.4496, '5.750': 0.4411, '5.875': 0.4327, '6.000': 0.4245, '6.125': 0.4164, '6.250': 0.4085, '6.375': 0.4007, '6.500': 0.3930, '6.625': 0.3855, '6.750': 0.3781, '6.875': 0.3708, '7.000': 0.3637, '7.125': 0.3567, '7.250': 0.3499, '7.375': 0.3431, '7.500': 0.3365, '7.625': 0.3300, '7.750': 0.3237, '7.875': 0.3174, '8.000': 0.3113, '8.125': 0.3053, '8.250': 0.2994, '8.375': 0.2936, '8.500': 0.2879, '8.625': 0.2824, '8.750': 0.2769, '8.875': 0.2716, '9.000': 0.2663 },
  63: { '3.000': 0.6833, '3.125': 0.6709, '3.250': 0.6587, '3.375': 0.6467, '3.500': 0.6349, '3.625': 0.6233, '3.750': 0.6120, '3.875': 0.6008, '4.000': 0.5898, '4.125': 0.5790, '4.250': 0.5684, '4.375': 0.5580, '4.500': 0.5477, '4.625': 0.5376, '4.750': 0.5277, '4.875': 0.5179, '5.000': 0.5083, '5.125': 0.4989, '5.250': 0.4896, '5.375': 0.4805, '5.500': 0.4715, '5.625': 0.4627, '5.750': 0.4540, '5.875': 0.4455, '6.000': 0.4371, '6.125': 0.4289, '6.250': 0.4208, '6.375': 0.4129, '6.500': 0.4051, '6.625': 0.3974, '6.750': 0.3899, '6.875': 0.3825, '7.000': 0.3752, '7.125': 0.3681, '7.250': 0.3611, '7.375': 0.3542, '7.500': 0.3474, '7.625': 0.3408, '7.750': 0.3343, '7.875': 0.3279, '8.000': 0.3216, '8.125': 0.3154, '8.250': 0.3094, '8.375': 0.3034, '8.500': 0.2976, '8.625': 0.2919, '8.750': 0.2863, '8.875': 0.2808, '9.000': 0.2754 },
  64: { '3.000': 0.6988, '3.125': 0.6864, '3.250': 0.6741, '3.375': 0.6621, '3.500': 0.6502, '3.625': 0.6386, '3.750': 0.6271, '3.875': 0.6159, '4.000': 0.6048, '4.125': 0.5939, '4.250': 0.5832, '4.375': 0.5726, '4.500': 0.5623, '4.625': 0.5521, '4.750': 0.5420, '4.875': 0.5321, '5.000': 0.5224, '5.125': 0.5128, '5.250': 0.5034, '5.375': 0.4941, '5.500': 0.4850, '5.625': 0.4761, '5.750': 0.4673, '5.875': 0.4586, '6.000': 0.4501, '6.125': 0.4417, '6.250': 0.4335, '6.375': 0.4254, '6.500': 0.4174, '6.625': 0.4096, '6.750': 0.4019, '6.875': 0.3943, '7.000': 0.3868, '7.125': 0.3795, '7.250': 0.3723, '7.375': 0.3652, '7.500': 0.3583, '7.625': 0.3514, '7.750': 0.3447, '7.875': 0.3381, '8.000': 0.3317, '8.125': 0.3253, '8.250': 0.3191, '8.375': 0.3130, '8.500': 0.3070, '8.625': 0.3011, '8.750': 0.2953, '8.875': 0.2896, '9.000': 0.2841 },
  65: { '3.000': 0.7145, '3.125': 0.7020, '3.250': 0.6897, '3.375': 0.6776, '3.500': 0.6657, '3.625': 0.6539, '3.750': 0.6424, '3.875': 0.6310, '4.000': 0.6198, '4.125': 0.6088, '4.250': 0.5980, '4.375': 0.5873, '4.500': 0.5768, '4.625': 0.5665, '4.750': 0.5563, '4.875': 0.5463, '5.000': 0.5364, '5.125': 0.5267, '5.250': 0.5172, '5.375': 0.5078, '5.500': 0.4985, '5.625': 0.4894, '5.750': 0.4804, '5.875': 0.4716, '6.000': 0.4629, '6.125': 0.4544, '6.250': 0.4460, '6.375': 0.4377, '6.500': 0.4296, '6.625': 0.4216, '6.750': 0.4137, '6.875': 0.4059, '7.000': 0.3983, '7.125': 0.3908, '7.250': 0.3834, '7.375': 0.3762, '7.500': 0.3690, '7.625': 0.3620, '7.750': 0.3551, '7.875': 0.3483, '8.000': 0.3416, '8.125': 0.3351, '8.250': 0.3287, '8.375': 0.3224, '8.500': 0.3162, '8.625': 0.3101, '8.750': 0.3041, '8.875': 0.2982, '9.000': 0.2924 },
  66: { '3.000': 0.7303, '3.125': 0.7177, '3.250': 0.7054, '3.375': 0.6931, '3.500': 0.6811, '3.625': 0.6693, '3.750': 0.6576, '3.875': 0.6461, '4.000': 0.6348, '4.125': 0.6237, '4.250': 0.6127, '4.375': 0.6019, '4.500': 0.5913, '4.625': 0.5808, '4.750': 0.5705, '4.875': 0.5603, '5.000': 0.5503, '5.125': 0.5405, '5.250': 0.5308, '5.375': 0.5212, '5.500': 0.5118, '5.625': 0.5026, '5.750': 0.4934, '5.875': 0.4845, '6.000': 0.4756, '6.125': 0.4669, '6.250': 0.4584, '6.375': 0.4500, '6.500': 0.4417, '6.625': 0.4335, '6.750': 0.4255, '6.875': 0.4176, '7.000': 0.4098, '7.125': 0.4021, '7.250': 0.3946, '7.375': 0.3871, '7.500': 0.3798, '7.625': 0.3726, '7.750': 0.3655, '7.875': 0.3585, '8.000': 0.3516, '8.125': 0.3449, '8.250': 0.3382, '8.375': 0.3317, '8.500': 0.3253, '8.625': 0.3190, '8.750': 0.3128, '8.875': 0.3067, '9.000': 0.3007 },
  67: { '3.000': 0.7462, '3.125': 0.7336, '3.250': 0.7212, '3.375': 0.7089, '3.500': 0.6968, '3.625': 0.6849, '3.750': 0.6731, '3.875': 0.6615, '4.000': 0.6501, '4.125': 0.6388, '4.250': 0.6277, '4.375': 0.6168, '4.500': 0.6060, '4.625': 0.5954, '4.750': 0.5849, '4.875': 0.5746, '5.000': 0.5644, '5.125': 0.5544, '5.250': 0.5445, '5.375': 0.5348, '5.500': 0.5252, '5.625': 0.5157, '5.750': 0.5064, '5.875': 0.4972, '6.000': 0.4882, '6.125': 0.4793, '6.250': 0.4706, '6.375': 0.4620, '6.500': 0.4535, '6.625': 0.4452, '6.750': 0.4370, '6.875': 0.4289, '7.000': 0.4209, '7.125': 0.4131, '7.250': 0.4054, '7.375': 0.3978, '7.500': 0.3903, '7.625': 0.3829, '7.750': 0.3757, '7.875': 0.3685, '8.000': 0.3615, '8.125': 0.3546, '8.250': 0.3478, '8.375': 0.3411, '8.500': 0.3345, '8.625': 0.3280, '8.750': 0.3216, '8.875': 0.3153, '9.000': 0.3091 },
  68: { '3.000': 0.7622, '3.125': 0.7495, '3.250': 0.7370, '3.375': 0.7246, '3.500': 0.7124, '3.625': 0.7004, '3.750': 0.6885, '3.875': 0.6768, '4.000': 0.6652, '4.125': 0.6538, '4.250': 0.6426, '4.375': 0.6315, '4.500': 0.6205, '4.625': 0.6097, '4.750': 0.5991, '4.875': 0.5886, '5.000': 0.5783, '5.125': 0.5681, '5.250': 0.5581, '5.375': 0.5482, '5.500': 0.5384, '5.625': 0.5288, '5.750': 0.5193, '5.875': 0.5100, '6.000': 0.5008, '6.125': 0.4917, '6.250': 0.4828, '6.375': 0.4741, '6.500': 0.4654, '6.625': 0.4569, '6.750': 0.4485, '6.875': 0.4402, '7.000': 0.4321, '7.125': 0.4241, '7.250': 0.4162, '7.375': 0.4084, '7.500': 0.4007, '7.625': 0.3931, '7.750': 0.3857, '7.875': 0.3783, '8.000': 0.3711, '8.125': 0.3640, '8.250': 0.3570, '8.375': 0.3501, '8.500': 0.3433, '8.625': 0.3366, '8.750': 0.3300, '8.875': 0.3235, '9.000': 0.3171 },
  69: { '3.000': 0.7784, '3.125': 0.7657, '3.250': 0.7531, '3.375': 0.7406, '3.500': 0.7283, '3.625': 0.7162, '3.750': 0.7042, '3.875': 0.6924, '4.000': 0.6807, '4.125': 0.6691, '4.250': 0.6577, '4.375': 0.6465, '4.500': 0.6354, '4.625': 0.6244, '4.750': 0.6136, '4.875': 0.6030, '5.000': 0.5925, '5.125': 0.5821, '5.250': 0.5719, '5.375': 0.5618, '5.500': 0.5519, '5.625': 0.5421, '5.750': 0.5324, '5.875': 0.5229, '6.000': 0.5135, '6.125': 0.5043, '6.250': 0.4952, '6.375': 0.4862, '6.500': 0.4774, '6.625': 0.4687, '6.750': 0.4601, '6.875': 0.4516, '7.000': 0.4433, '7.125': 0.4351, '7.250': 0.4270, '7.375': 0.4190, '7.500': 0.4111, '7.625': 0.4034, '7.750': 0.3957, '7.875': 0.3882, '8.000': 0.3808, '8.125': 0.3735, '8.250': 0.3663, '8.375': 0.3592, '8.500': 0.3522, '8.625': 0.3454, '8.750': 0.3386, '8.875': 0.3319, '9.000': 0.3253 },
  70: { '3.000': 0.7947, '3.125': 0.7819, '3.250': 0.7693, '3.375': 0.7568, '3.500': 0.7444, '3.625': 0.7322, '3.750': 0.7201, '3.875': 0.7082, '4.000': 0.6964, '4.125': 0.6847, '4.250': 0.6732, '4.375': 0.6618, '4.500': 0.6505, '4.625': 0.6394, '4.750': 0.6284, '4.875': 0.6176, '5.000': 0.6069, '5.125': 0.5963, '5.250': 0.5859, '5.375': 0.5756, '5.500': 0.5654, '5.625': 0.5554, '5.750': 0.5455, '5.875': 0.5357, '6.000': 0.5261, '6.125': 0.5166, '6.250': 0.5073, '6.375': 0.4981, '6.500': 0.4890, '6.625': 0.4801, '6.750': 0.4713, '6.875': 0.4626, '7.000': 0.4540, '7.125': 0.4456, '7.250': 0.4373, '7.375': 0.4291, '7.500': 0.4210, '7.625': 0.4130, '7.750': 0.4052, '7.875': 0.3974, '8.000': 0.3898, '8.125': 0.3823, '8.250': 0.3749, '8.375': 0.3676, '8.500': 0.3604, '8.625': 0.3533, '8.750': 0.3463, '8.875': 0.3394, '9.000': 0.3327 },
  71: { '3.000': 0.8111, '3.125': 0.7983, '3.250': 0.7856, '3.375': 0.7730, '3.500': 0.7606, '3.625': 0.7483, '3.750': 0.7362, '3.875': 0.7242, '4.000': 0.7123, '4.125': 0.7006, '4.250': 0.6890, '4.375': 0.6775, '4.500': 0.6662, '4.625': 0.6549, '4.750': 0.6439, '4.875': 0.6329, '5.000': 0.6221, '5.125': 0.6114, '5.250': 0.6008, '5.375': 0.5904, '5.500': 0.5801, '5.625': 0.5699, '5.750': 0.5599, '5.875': 0.5500, '6.000': 0.5402, '6.125': 0.5305, '6.250': 0.5210, '6.375': 0.5116, '6.500': 0.5023, '6.625': 0.4931, '6.750': 0.4841, '6.875': 0.4752, '7.000': 0.4664, '7.125': 0.4577, '7.250': 0.4491, '7.375': 0.4407, '7.500': 0.4324, '7.625': 0.4241, '7.750': 0.4160, '7.875': 0.4080, '8.000': 0.4001, '8.125': 0.3923, '8.250': 0.3847, '8.375': 0.3772, '8.500': 0.3698, '8.625': 0.3624, '8.750': 0.3552, '8.875': 0.3481, '9.000': 0.3411 },
  72: { '3.000': 0.8277, '3.125': 0.8149, '3.250': 0.8021, '3.375': 0.7895, '3.500': 0.7770, '3.625': 0.7646, '3.750': 0.7524, '3.875': 0.7403, '4.000': 0.7283, '4.125': 0.7164, '4.250': 0.7047, '4.375': 0.6931, '4.500': 0.6816, '4.625': 0.6703, '4.750': 0.6591, '4.875': 0.6480, '5.000': 0.6371, '5.125': 0.6263, '5.250': 0.6156, '5.375': 0.6050, '5.500': 0.5946, '5.625': 0.5843, '5.750': 0.5741, '5.875': 0.5641, '6.000': 0.5542, '6.125': 0.5444, '6.250': 0.5347, '6.375': 0.5252, '6.500': 0.5157, '6.625': 0.5064, '6.750': 0.4972, '6.875': 0.4881, '7.000': 0.4791, '7.125': 0.4703, '7.250': 0.4615, '7.375': 0.4529, '7.500': 0.4444, '7.625': 0.4360, '7.750': 0.4277, '7.875': 0.4195, '8.000': 0.4114, '8.125': 0.4034, '8.250': 0.3955, '8.375': 0.3877, '8.500': 0.3801, '8.625': 0.3725, '8.750': 0.3650, '8.875': 0.3577, '9.000': 0.3504 },
  73: { '3.000': 0.8443, '3.125': 0.8315, '3.250': 0.8187, '3.375': 0.8061, '3.500': 0.7935, '3.625': 0.7811, '3.750': 0.7688, '3.875': 0.7566, '4.000': 0.7445, '4.125': 0.7325, '4.250': 0.7207, '4.375': 0.7089, '4.500': 0.6973, '4.625': 0.6858, '4.750': 0.6744, '4.875': 0.6632, '5.000': 0.6520, '5.125': 0.6410, '5.250': 0.6302, '5.375': 0.6194, '5.500': 0.6088, '5.625': 0.5983, '5.750': 0.5880, '5.875': 0.5778, '6.000': 0.5677, '6.125': 0.5577, '6.250': 0.5479, '6.375': 0.5381, '6.500': 0.5285, '6.625': 0.5190, '6.750': 0.5096, '6.875': 0.5003, '7.000': 0.4912, '7.125': 0.4821, '7.250': 0.4732, '7.375': 0.4644, '7.500': 0.4557, '7.625': 0.4471, '7.750': 0.4387, '7.875': 0.4303, '8.000': 0.4220, '8.125': 0.4139, '8.250': 0.4058, '8.375': 0.3979, '8.500': 0.3901, '8.625': 0.3823, '8.750': 0.3747, '8.875': 0.3672, '9.000': 0.3598 },
  74: { '3.000': 0.8611, '3.125': 0.8482, '3.250': 0.8354, '3.375': 0.8227, '3.500': 0.8101, '3.625': 0.7976, '3.750': 0.7853, '3.875': 0.7730, '4.000': 0.7608, '4.125': 0.7488, '4.250': 0.7368, '4.375': 0.7250, '4.500': 0.7133, '4.625': 0.7017, '4.750': 0.6902, '4.875': 0.6789, '5.000': 0.6676, '5.125': 0.6565, '5.250': 0.6455, '5.375': 0.6346, '5.500': 0.6238, '5.625': 0.6132, '5.750': 0.6027, '5.875': 0.5923, '6.000': 0.5820, '6.125': 0.5719, '6.250': 0.5619, '6.375': 0.5520, '6.500': 0.5421, '6.625': 0.5325, '6.750': 0.5229, '6.875': 0.5134, '7.000': 0.5041, '7.125': 0.4948, '7.250': 0.4857, '7.375': 0.4767, '7.500': 0.4678, '7.625': 0.4590, '7.750': 0.4504, '7.875': 0.4418, '8.000': 0.4334, '8.125': 0.4251, '8.250': 0.4168, '8.375': 0.4087, '8.500': 0.4007, '8.625': 0.3929, '8.750': 0.3851, '8.875': 0.3774, '9.000': 0.3698 },
  75: { '3.000': 0.8780, '3.125': 0.8651, '3.250': 0.8522, '3.375': 0.8395, '3.500': 0.8268, '3.625': 0.8143, '3.750': 0.8019, '3.875': 0.7895, '4.000': 0.7773, '4.125': 0.7651, '4.250': 0.7531, '4.375': 0.7411, '4.500': 0.7293, '4.625': 0.7176, '4.750': 0.7060, '4.875': 0.6945, '5.000': 0.6831, '5.125': 0.6719, '5.250': 0.6607, '5.375': 0.6497, '5.500': 0.6388, '5.625': 0.6280, '5.750': 0.6174, '5.875': 0.6068, '6.000': 0.5964, '6.125': 0.5861, '6.250': 0.5759, '6.375': 0.5658, '6.500': 0.5558, '6.625': 0.5460, '6.750': 0.5362, '6.875': 0.5266, '7.000': 0.5170, '7.125': 0.5076, '7.250': 0.4983, '7.375': 0.4891, '7.500': 0.4800, '7.625': 0.4710, '7.750': 0.4621, '7.875': 0.4533, '8.000': 0.4447, '8.125': 0.4361, '8.250': 0.4277, '8.375': 0.4193, '8.500': 0.4111, '8.625': 0.4030, '8.750': 0.3950, '8.875': 0.3871, '9.000': 0.3793 },
  76: { '3.000': 0.8951, '3.125': 0.8821, '3.250': 0.8692, '3.375': 0.8564, '3.500': 0.8437, '3.625': 0.8311, '3.750': 0.8186, '3.875': 0.8062, '4.000': 0.7939, '4.125': 0.7817, '4.250': 0.7695, '4.375': 0.7575, '4.500': 0.7456, '4.625': 0.7338, '4.750': 0.7220, '4.875': 0.7104, '5.000': 0.6989, '5.125': 0.6875, '5.250': 0.6762, '5.375': 0.6650, '5.500': 0.6539, '5.625': 0.6430, '5.750': 0.6321, '5.875': 0.6214, '6.000': 0.6108, '6.125': 0.6004, '6.250': 0.5900, '6.375': 0.5797, '6.500': 0.5696, '6.625': 0.5596, '6.750': 0.5497, '6.875': 0.5399, '7.000': 0.5302, '7.125': 0.5206, '7.250': 0.5111, '7.375': 0.5017, '7.500': 0.4924, '7.625': 0.4833, '7.750': 0.4742, '7.875': 0.4653, '8.000': 0.4564, '8.125': 0.4477, '8.250': 0.4391, '8.375': 0.4306, '8.500': 0.4222, '8.625': 0.4139, '8.750': 0.4057, '8.875': 0.3976, '9.000': 0.3897 },
  77: { '3.000': 0.9123, '3.125': 0.8993, '3.250': 0.8864, '3.375': 0.8735, '3.500': 0.8607, '3.625': 0.8481, '3.750': 0.8355, '3.875': 0.8230, '4.000': 0.8106, '4.125': 0.7983, '4.250': 0.7861, '4.375': 0.7740, '4.500': 0.7620, '4.625': 0.7500, '4.750': 0.7382, '4.875': 0.7265, '5.000': 0.7149, '5.125': 0.7033, '5.250': 0.6919, '5.375': 0.6806, '5.500': 0.6694, '5.625': 0.6583, '5.750': 0.6473, '5.875': 0.6364, '6.000': 0.6256, '6.125': 0.6150, '6.250': 0.6044, '6.375': 0.5939, '6.500': 0.5836, '6.625': 0.5734, '6.750': 0.5632, '6.875': 0.5532, '7.000': 0.5433, '7.125': 0.5335, '7.250': 0.5238, '7.375': 0.5142, '7.500': 0.5047, '7.625': 0.4953, '7.750': 0.4861, '7.875': 0.4769, '8.000': 0.4679, '8.125': 0.4590, '8.250': 0.4502, '8.375': 0.4415, '8.500': 0.4329, '8.625': 0.4244, '8.750': 0.4160, '8.875': 0.4077, '9.000': 0.3996 },
  78: { '3.000': 0.9297, '3.125': 0.9166, '3.250': 0.9036, '3.375': 0.8907, '3.500': 0.8779, '3.625': 0.8651, '3.750': 0.8525, '3.875': 0.8399, '4.000': 0.8274, '4.125': 0.8150, '4.250': 0.8027, '4.375': 0.7905, '4.500': 0.7783, '4.625': 0.7663, '4.750': 0.7543, '4.875': 0.7425, '5.000': 0.7307, '5.125': 0.7190, '5.250': 0.7075, '5.375': 0.6960, '5.500': 0.6846, '5.625': 0.6734, '5.750': 0.6622, '5.875': 0.6512, '6.000': 0.6402, '6.125': 0.6294, '6.250': 0.6187, '6.375': 0.6081, '6.500': 0.5976, '6.625': 0.5872, '6.750': 0.5770, '6.875': 0.5668, '7.000': 0.5567, '7.125': 0.5468, '7.250': 0.5370, '7.375': 0.5272, '7.500': 0.5176, '7.625': 0.5081, '7.750': 0.4987, '7.875': 0.4894, '8.000': 0.4802, '8.125': 0.4711, '8.250': 0.4621, '8.375': 0.4533, '8.500': 0.4445, '8.625': 0.4359, '8.750': 0.4273, '8.875': 0.4189, '9.000': 0.4106 },
  79: { '3.000': 0.9472, '3.125': 0.9340, '3.250': 0.9210, '3.375': 0.9080, '3.500': 0.8951, '3.625': 0.8822, '3.750': 0.8695, '3.875': 0.8568, '4.000': 0.8442, '4.125': 0.8317, '4.250': 0.8193, '4.375': 0.8070, '4.500': 0.7947, '4.625': 0.7826, '4.750': 0.7705, '4.875': 0.7585, '5.000': 0.7466, '5.125': 0.7348, '5.250': 0.7231, '5.375': 0.7115, '5.500': 0.7000, '5.625': 0.6885, '5.750': 0.6772, '5.875': 0.6660, '6.000': 0.6549, '6.125': 0.6439, '6.250': 0.6330, '6.375': 0.6222, '6.500': 0.6115, '6.625': 0.6010, '6.750': 0.5905, '6.875': 0.5801, '7.000': 0.5699, '7.125': 0.5597, '7.250': 0.5497, '7.375': 0.5397, '7.500': 0.5299, '7.625': 0.5202, '7.750': 0.5106, '7.875': 0.5011, '8.000': 0.4917, '8.125': 0.4824, '8.250': 0.4733, '8.375': 0.4642, '8.500': 0.4553, '8.625': 0.4465, '8.750': 0.4378, '8.875': 0.4292, '9.000': 0.4207 },
  80: { '3.000': 0.9500, '3.125': 0.9500, '3.250': 0.9385, '3.375': 0.9254, '3.500': 0.9124, '3.625': 0.8995, '3.750': 0.8866, '3.875': 0.8738, '4.000': 0.8611, '4.125': 0.8485, '4.250': 0.8360, '4.375': 0.8236, '4.500': 0.8112, '4.625': 0.7989, '4.750': 0.7867, '4.875': 0.7746, '5.000': 0.7625, '5.125': 0.7506, '5.250': 0.7387, '5.375': 0.7270, '5.500': 0.7153, '5.625': 0.7037, '5.750': 0.6923, '5.875': 0.6809, '6.000': 0.6696, '6.125': 0.6584, '6.250': 0.6474, '6.375': 0.6364, '6.500': 0.6255, '6.625': 0.6148, '6.750': 0.6041, '6.875': 0.5936, '7.000': 0.5831, '7.125': 0.5728, '7.250': 0.5626, '7.375': 0.5524, '7.500': 0.5424, '7.625': 0.5325, '7.750': 0.5227, '7.875': 0.5130, '8.000': 0.5034, '8.125': 0.4939, '8.250': 0.4845, '8.375': 0.4752, '8.500': 0.4661, '8.625': 0.4570, '8.750': 0.4481, '8.875': 0.4393, '9.000': 0.4306 },
}

// Maximum PLF cap (HUD rules)
const MAX_PLF = 0.9500

/**
 * Round expected rate to nearest 0.125%
 */
export function roundToNearestEighth(rate: number): number {
  return Math.round(rate / 0.125) * 0.125
}

/**
 * Format rate as PLF table key string
 */
function formatRateKey(rate: number): string {
  return rate.toFixed(3)
}

/**
 * Look up PLF for a given age and expected rate (in percent, e.g. 5.5 for 5.5%)
 * Returns the PLF factor (e.g. 0.4583)
 */
export function lookupPLF(age: number, expectedRatePercent: number): number {
  const clampedAge = Math.min(Math.max(age, 62), 80)
  const roundedRate = roundToNearestEighth(expectedRatePercent)
  const clampedRate = Math.min(Math.max(roundedRate, 3.0), 9.0)
  const rateKey = formatRateKey(clampedRate)

  const ageRow = PLF_TABLE[clampedAge]
  if (!ageRow) return 0

  const plf = ageRow[rateKey]
  if (plf === undefined) {
    // Interpolate or use nearest
    const keys = Object.keys(ageRow).map(Number).sort((a, b) => a - b)
    const nearest = keys.reduce((prev, curr) =>
      Math.abs(curr - clampedRate) < Math.abs(prev - clampedRate) ? curr : prev
    )
    return Math.min(ageRow[formatRateKey(nearest)] ?? 0, MAX_PLF)
  }

  return Math.min(plf, MAX_PLF)
}

/**
 * Calculate HECM Principal Limit
 * @param homeValueCents - Home value in cents
 * @param youngesterBorrowerAge - Age of younger borrower
 * @param expectedRateBps - Expected interest rate in basis points (e.g., 550 = 5.5%)
 * @param lendingLimitCents - HUD lending limit in cents
 * @returns Principal Limit in cents
 */
export function calculatePrincipalLimit(
  homeValueCents: number,
  youngestBorrowerAge: number,
  expectedRateBps: number,
  lendingLimitCents: number
): number {
  const effectiveValueCents = Math.min(homeValueCents, lendingLimitCents)
  const expectedRatePercent = expectedRateBps / 100
  const plf = lookupPLF(youngestBorrowerAge, expectedRatePercent)
  return Math.floor(effectiveValueCents * plf)
}
